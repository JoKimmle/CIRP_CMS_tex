% Template for Elsevier CRC journal article
% version 1.2 dated 09 May 2011
%------------------------------------------

%% The '3p' and 'times' class options of elsarticle are used for Elsevier CRC
%% The 'procedia' option causes ecrc to approximate to the Word template
\documentclass[5p,times,procedia]{elsarticle}
\flushbottom



%% The `ecrc' package must be called to make the CRC functionality available
\usepackage{ecrc}
\usepackage{amsmath}

% JO bibliography:
%\usepackage[sorting=none]{biblatex} %biblatex -nope!
%\addbibresource{Bibliography.bib}   %biblatex -nope!
%\usepackage{natbib}                 %natbib.  -nope!
%\bibliographystyle{unsrtnat}        %unsrtnat -nope!

% Jo color definition:
\usepackage{xcolor}
\definecolor{notecolor}{rgb}{0.16, 0.67, 0.53}

% JO note environment:
\newenvironment{note}{%
	\noindent
    \color{notecolor}%
}{%
    \par\medskip%
}


\usepackage{siunitx} %SI-units
\usepackage{eurosym} %euro symbol
%\usepackage{hyperref}



%% set the volume if you know. Otherwise `00'
\volume{00}

%% set the starting page if not 1
\firstpage{1}

%% Give the name of the journal
\journalname{Procedia CIRP}

%% Give the author list to appear in the running head
%% Example \runauth{C.V. Radhakrishnan et al.}
\runauth{J. Kimmle et al.}

%% The choice of journal logo is determined by the \jid and \jnltitlelogo commands.
%% A user-supplied logo with the name <\jid>logo.pdf will be inserted if present.
%% e.g. if \jid{yspmi} the system will look for a file yspmilogo.pdf
%% Otherwise the content of \jnltitlelogo will be set between horizontal lines as a default logo

%% Give the abbreviation of the Journal.
\jid{trpro}

%% Give a short journal name for the dummy logo (if needed)
%\jnltitlelogo{Transportation Research}

%% Hereafter the template follows `elsarticle'.
%% For more details see the existing template files elsarticle-template-harv.tex and elsarticle-template-num.tex.

%% Elsevier CRC generally uses a numbered reference style
%% For this, the conventions of elsarticle-template-num.tex should be followed (included below)
%% If using BibTeX, use the style file elsarticle-num.bst

%% End of ecrc-specific commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% The amssymb package provides various useful mathematical symbols
\usepackage{amssymb}


% if you have landscape tables
\usepackage[figuresright]{rotating}
%\usepackage{harvard}
% put your own definitions here:x
%   \newcommand{\cZ}{\cal{Z}}
%   \newtheorem{def}{Definition}[section]
%   ...

% add words to TeX's hyphenation exception list
%\hyphenation{author another created financial paper re-commend-ed Post-Script}

% declarations for front matter

\usepackage[bookmarks=false]{hyperref}
    \hypersetup{colorlinks,
      linkcolor=blue,
      citecolor=blue,
      urlcolor=blue}


\begin{document}
\begin{frontmatter}



%% Title, authors and addresses

%% use the tnoteref command within \title for footnotes;
%% use the tnotetext command for the associated footnote;
%% use the fnref command within \author or \address for footnotes;
%% use the fntext command for the associated footnote;
%% use the corref command within \author for corresponding author footnotes;
%% use the cortext command for the associated footnote;
%% use the ead command for the email address,
%% and the form \ead[url] for the home page:
%%
%% \title{Title\tnoteref{label1}}
%% \tnotetext[label1]{}
%% \author{Name\corref{cor1}\fnref{label2}}
%% \ead{email address}
%% \ead[url]{home page}
%% \fntext[label2]{}
%% \cortext[cor1]{}
%% \address{Address\fnref{label3}}
%% \fntext[label3]{}

\dochead{57th CIRP Conference on Manufacturing Systems 2024 (CMS 2024)}

\title{Digital twin based online material defect detection for CNC-milled workpieces}

%% use optional labels to link authors explicitly to addresses:
%% \author[label1,label2]{<author name>}
%% \address[label1]{<address>}
%% \address[label2]{<address>}



\author[a,b]{Johannes Kimmle} 
\author[a,c]{Dominik Lucke\corref{cor1}}%$\ast$}} %{cor1}
\author[b]{Konrad von Leipzig}
%\ead{author@institute.xxx}

\address[a]{ESB Business School, Reutlingen University, Alteburgstra\ss e 150, 72762 Reutlingen, Germany}
\address[b]{Department of Industrial Engineering, Stellenbosch University, Joubert Street, Stellenbosch, 7600, South Africa}
\address[c]{Fraunhofer Institute for Manufacturing Engineering and Automation IPA, Nobelstra\ss e 12, 70569 Stuttgart, Germany}

\aucores{* Corresponding author. Tel.: +49-7121-271-5005; fax: +49-7121-271-90-5005; E-mail address: dominik.lucke@reutlingen-university.de}

\begin{abstract}
Reliable lot-size-one compatible online quality monitoring for CNC machined parts remains elusive.
To address this challenge, our approach aims to bridge the current gap in research by developing a cost-effective and reference-independent monitoring concept for material defect detection in CNC-machined parts. This paper presents a novel digital twin-based method, utilising machining vibrations and a g-code-based encoding of the cutting process. The objective is to detect material defects, such as blowholes, without the need for individual workpiece references. The proposed method aims to reduce barriers to entry, minimise waste, and enhance machine productivity by enabling automated early online quality control. To develop and validate the model, we generate a new dataset combining machining vibration with technological context data such as chip-shape. We demonstrate the feasibility and potential of the approach in a job shop setting on a 3-axis CNC mill.
\end{abstract}

\begin{keyword}
 Online process monitoring \sep Material defect detection \sep Digital Twin

%old: Monitoring \sep Machining \sep Material defects \sep Vibrations \sep Lot size one

%% keywords here, in the form: keyword \sep keyword

%% PACS codes here, in the form: \PACS code \sep code

%% MSC codes here, in the form: \MSC code \sep code
%% or \MSC[2008] code \sep code (2000 is the default)

\end{keyword}\cortext[cor1]{Corresponding author. Tel.: +49-7121-271-5005; fax: +49-7121-271-90-5005; E-mail address: dominik.lucke@reutlingen-university.de}

\end{frontmatter}


%=====================================================================
%=====================================================================
\section{Introduction}\label{Sec_Introduction}


The manufacturing industry is undergoing a paradigm shift, transitioning from a focus on responsiveness to a market-of-one, deemed Mass Individualisation\cite{Lu.Xu.ea2020} or Mass Personalisation \cite{Qin.Lu2021}. This entails the production of custom-made products while maintaining the low unit costs traditionally associated with mass production.
In response, there has been a global push towards smart manufacturing characterised by autonomous operations enabled by advanced sensing, data processing, and decision-making technologies. \cite{Gu.Koren2022, Lu.Morris.ea2016}

Within this context, reducing lot sizes in job-shop settings becomes imperative.
Smarter, more self-aware production machines pose as a fundemental enabler for the new paradigm. This can be achieved by employing deep process-focused monitoring systems to generate reference agnostic - lot size one capable - process status insights.

Such a workpiece-centred monitoring system, which detects material defects or operator errors (e.g. wrong material, or part clamping errors) during normal machining, can increase process efficiency \& reliability, reduce waste, and enable higher product quality.  

To achieve economic efficiency and general market accessibility, this lot-size-one capable system must be easy to integrate, machine-agnostic, and relatively low-cost.

%\vspace*{8pt}
\vspace*{-.5\baselineskip}
\begin{nomenclature}
\begin{deflist}[AAA]%number of letters
\defitem{AE}\defterm{Acoustic Emission}
\defitem{CNC}\defterm{Numerical Controled (machine tool)}
\defitem{DoE}\defterm{Design of Experiments}
\defitem{ML}\defterm{Machine Learning}
\defitem{MLP}\defterm{Multi Layer Perceptron}
\defitem{UPC}\defterm{Unique (context) Parameter Combination}
\end{deflist}
\end{nomenclature}\vskip24pt






 
%=====================================================================
\section{Related work}\label{Sec_RelatedWork}


%Machine tool and machine tool control munafacturers integrate all kind of monitoring capabilities in their products. Modern CNC mills are usually factory-fitted with spindle and axis drive energy meters where spindle tourque and axis resistance can be estimated from.

%Most of these focus on tool wear, surface finish optimisation, or machine maintenance. 
%Holistic process specific monitoring especially of the workpiece is rarely employed on today's shop floors or in current research.\\

%Almost exclusively CNC monitoring is focused on tool condition monitoring (especially tool wear and breakage), surface finish quality (including chatter), and machine health monitoring (within the scope of predictive maintenance) .
Predominantly, CNC monitoring is focused on tool condition monitoring, particularly detecting tool wear and breakage, ensuring surface finish quality, including mitigating chatter, and monitoring machine health for predictive maintenance purposes \cite[p.2727]{Kuntoglu.Salur.ea2021}.
The following sensors are in use for CNC monitoring and are rated by investment cost and information value (see: Table \ref{Tab_Sensors}).
\vspace*{-.5\baselineskip}


\begin{table}[h]
\footnotesize
\caption{Sensors according to signals and properties \cite[according to][p.2725]{Kuntoglu.Salur.ea2021}}
\label{Tab_Sensors}

\begin{tabular*}{\hsize}{@{\extracolsep{\fill}}lll@{}}
\toprule
Sensor & Level of investment cost & Extent of signal accuracy\\ && and information value\\
\colrule
Dynamometer    & $\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}   & $\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}\\
Accelerometer  &   $\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}   &  $\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}\\
AE             & $\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}     & $\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm} \\
Current/power  & $\bullet$\hspace{.5mm}      & $\bullet$\hspace{.5mm}  \\
Temperature    & $\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}      & $\bullet$\hspace{.5mm}$\bullet$\hspace{.5mm}  \\
Sound          & $\bullet$\hspace{.5mm}      & $\bullet$\hspace{.5mm}  \\
\botrule 
\end{tabular*}
\end{table}

\vspace*{-.5\baselineskip}
Dynamometers commonly utilise all six spatial axes (three translatory and three rotatory) to capture force profiles at high sampling rates, with higher rates correlating with increased cost.
Vibrations measured by accelerometers refer to the oscillatory motion of an object or system around an equilibrium position ($f_{acc}$ $\lesssim$ 10 kHz).
AE refers specifically to the release of stress waves or energy due to internal changes or deformation within a material. AE is difficult to measure in lower frequencies; usual frequencies band is: 20 kHz $\lesssim$ $f_{AE}$ $\lesssim$ 500 kHz. \cite{Jozwik.Mika2015, Sun.Hu.ea2020}

Current/power is measured from the drive unit of the spindle, which approximates into spindle torque and is therefore extremely cost-effective.
Temperature, mostly measured via thermal imaging cameras, lack high sample rates (due to low frame rates), and suffer from delays and perspective obstacles. 



\subsection{Similar monitoring solutions}
\vspace*{-\baselineskip}


\href{https://www.matta.ai/greymatta}{Matta's Grey-1 model} as shown in their paper \cite{Brion.Pattinson2022} demonstrates additive manufacturing process monitoring on fused layer deposit 3D printers, based on an automated deep process understanding. 
They trained a multi head transformer model on labeled images; labels such as: extrusion speed, layer thickness and hotend temperature. They are able to detect extrusions errors (which translate into material defects), or adjust printing parameters fully autonomously for unseen material. \cite{Brion.Pattinson2022}


\cite{Pfirrmann.Baumann.ea2021} investigates the cutting forces measured by a (6-axis) dynamometer in the micromanufacturing of Ti6246 alloy by comparing them with theoretically calculated forces, to detect material defects such as blowholes.
This approach is in theory lot size one capable because the force measurement is not compared to a previsouly manufacured 1:1 reference, but rather is based on experimental measurements and a geometric physics-based process simulation. 
It is concluded that the accuracy of the calculated force and the insufficient change in amplitude between normal and defect machining are too low to achieve automated detection. \cite[p.169]{Pfirrmann.Baumann.ea2021} 

While dynamometer force measurements offer the highest signal accuracy and information value due to their direct measurement method and process proximity \cite[]{Korkmaz.Yasar.ea2020}, they are expensive (\euro $10^4$ magnitude), difficult to set up, and usually not feasible for production environments (compare Table \ref{Tab_Sensors}).

Qass's Optimizer 4D, an off-the-shelf AE-based general-purpose inspection system, addresses the problems of dynamometers described above, at the cost of reduced signal accuracy. The system is still expensive, but it comes with out-of-the-box spectral pattern recognition, which enables reference-dependent material defect detection, thus is not lot size one capable. \cite[p.5]{Szulewski.Sniegulska-Gradzka2017}

\vspace*{.5\baselineskip}
\noindent The current research gap in this field is concluded as follows: \label{gap}
\vspace*{-\baselineskip}
\begin{itemize}
	\item Research in online CNC workpiece quality monitoring remains relatively underexplored.
	\item Material defect detection represents a particular under-researched subfield.
	\item Only one single paper has been identified thus far that addresses reference-independent defect monitoring within this domain. % (and did not suceed, see \cite[p.5]{Szulewski.Sniegulska-Gradzka2017}).
\end{itemize}










%=====================================================================
\section{Aproach}\label{Sec_Aproach}
The proposed aproach to enable the Mass Personalisation paradigm shift in the realm of CNC-mill monitoring is based on deep process context (e.g. technological, geometric, or material property data) to generate 1:1 reference agnostic (lot size one capable) process status insights.

A digital twin offers the solution to meet the requirements and address the identified research gap, in the form of a cyber physical representation of the machining process where context is extracted based on corresponding machine states.
This is achieved by integrating affordable retrofit sensors that do not interfere with machining, and a digital twin based encoding of the cutting process for contextual reference, enabling effective lot-size one monitoring.

The following chapters cover which physical quantity best suits the requirements, the selection and creation of machining-context features, and the general concept architecture based on these features and employed physical quantity.


\subsection{Physical quanitity to monitor}
\vspace*{-\baselineskip}
Vibrations measured via accelerometers or Acoustic Emission (AE) sensors form a great compromise between ease of installation \& cost, and signal accuracy \& information value. While Dynamometers entail greater information value, their high cost and poor mountability don't make them viable for general monitoring. Other options such as 'current/power' 'temperature' or 'sound' hold lower information value and are therefore not considered.

The easily and cheaply achievable high sampling rates of vibration measuremnts are an enormous advantage when zooming in in the timedomain and analysing each cutting event (cutting edge engagement). As the paper \cite{Pfirrmann.Baumann.ea2021} shows that especially smaller/micro material defects affect machining forces for just a few edge engagements, lasting in total a few microseconds.

\subsection{Machining-context features}
\vspace*{-\baselineskip}

Key aspect of the proposed aproach is to substitute a 1:1 reference of the same part manufactured prior, by general machining and cutting conditions and circumstances for each point in time in the manufacturing process. This data is refered to as 'context'.

The routine that was followed for the context features creation, including: finding, abstracting, generalising, and uncoupling coefficients, is described by 3 aspects in the following sections:


\subsubsection{Influencial factors of the cutting process}\label{ascpect1}
%What factors influence the cutting process?
Primary influencial factors of the cutting process are:
\vspace*{-\baselineskip}
	\begin{itemize}
		\item workpiece geometry, clamping, and material characterstics (e.g. e-module)
		\item tool type (shape), coating (surface) and cutting fluid
		\item machine kinemantics, stiffness, and sub componenent noise
		\item cutting process on chip level (e.g. rake angle)
		\item generall milling process (e.g. cutting speed: $v_c$)
		\item others: temperature, chip extraction, direction, etc.
	\end{itemize}	
	\vspace*{-\baselineskip}
	The above factors affect the cutting process, some directly by influencing the load on the material being removed, ultimately resulting in a change in the virbation pattern. Others affect the process indirectly through resonance, e.g. slender workpiece geometries are excited at their natural frequency.
	
\subsubsection{Universal process description based on the factors described before}\label{ascpect2}
	Some factors can not be generalised, or are not feasable to do so. Those factors stay as static features that need specific learning later.
	Incomprhesible features e.g. 'specific machine' can not be generalised because of their complex nature, therefore each machine needs custom learning.
	Other features are not feasable to generalize because they would make the medel too complex: e.g. material characterisitcs can be explained by more general features such as hardness, tensile strength, etc. Due to the high number of material features, we decided to custom train each material.
	We have identified the following static features on which later learning is based:
	material, machine, clamping/fixture, tool type, and cutting fluid.
	
	Factors that are generalisable - where comprehensible and detachable features with general predication can be derived from - are prefered and form the backbone of deep process insights. E.g. cutting speed $v_c$, is machine, material and tool independent while having substential influence on the cutting process, ultimatly influencing sensor signal patterns.
	
	Factors that require specifc sensors in order to be captured, such as temperature, are excluded from the model to keep complexity manageable.
	
\subsubsection{Modelling of the factors as mathematically independent coeffecients}\label{ascpect3}
%How can these factors be modelled as mathematically independent (uncoupled, lower-dimensional) coefficients?
	To achieve high quality training data interdependence or correlation among features is to be avoided.
	Most classical technological paramters are interdependent: e.g. infeed $a_p [mm]$ is dependent on tool diamter $d [mm]$, that means by changing the tool to a bigger diameter, the ratio from $a_p$ and $d$ changes. To fix this $a_p$ needs dimensional reduction: from $a_p [mm]$ to $\frac{a_p}{d} [\%]$ removing the interdependence of $d$. Feed rate $f$ is dependent on cutting speed $v_c$ and tool diameter $d$. Uncoupled $f$ translates into feed rate per tooth $f_z$.
	
	We found the following independent coeffiecients:
	tool diameter $d$, cutting speed $v_c$, infeed percent $a_{p\%}$, cutting depth $a_e$, tool edge number $z$, direction, milling mode (climb or up-cut), spindle speed $n$
		
	Additional features are modelled to better describe the cutting context such as: contact arc (angle of attack where tool is in contact with workpiece), arc direction (direction vector of contact arc), chip volume, cutting frequency, 
	
	Not all the considered factors can be fully modelled, so there is always some loss of information.
	Whether the remaining information is sufficient to model the cutting context is analysed in the proof-of-concept implementation.



The final context features are a mix of static features concluded in \ref{ascpect2}  (e.g. material), independent coefficients (e.g. feed rate per tooth), as well as additionally modeled features (e.g. contact arc) from \ref{ascpect3}.





\subsection{Concept architecture}\label{Sec_ConceptArchitecture}
\vspace*{-\baselineskip}
The general aproach to the lot size one capable material defect monitoring integrates dirctly into common pre-existent production interfaces to enable easy machine agnostic retrofitting. The full concept architecture is shown in Fig. \ref{Fig_ConceptDiagram}.
The diagram centers around the 'CNC Mill' including its CNC Controler' in the bottom center. The process steps highlighted in bright green colour represent the standard information flow on the shop floor for CNC machines - no monitoring -just the pre-existent 'Conventional Shop Procedure'.
The monitoring system integrates right on top of this procedure which can be subdiveded into four 'Monitoring Procedures' (grey boxes): 'Signal Acquisition \& Preperation', 'Context Acquisition \& Generation', 'Signal Context Overlay', and 'Contextualised Classification'.

Inside those procedure boxes (bright green and grey) are dark blue coloured 'Process Steps', specific functions that process information. Information flows in and out of these dark blue 'Process Steps', this flow and exchange of information is visualised with arrows and rounded boxes in turquoise colour, we called them 'Exchanged Inforamtion'.
See the diagram for details.

To detect defects while machining, the architecture is designed to be real-time capable. The 'Conventional Shop Proecdure' - except milling itself - and 'Context Acquisition \& Generation' procedures are deterministic and therefore can be calculated beforehand, all other procedures must be real time capable, including 'Signal Acquisition', 'Signal-Context Overlay' and the 'Contextualised Classification'.

The ML architecture, as part of the 'Contextualised Classification' procedure, must be real-time capable as well. This means that in production the trained model is fed constantly with a fixed length of overlapping short vibration snippets ($\sim0.5 s$ duration) and according context data specific to each vibration snippet.  

\begin{figure*}[t]
    \centering
    \includegraphics[width=0.99\linewidth]{ConceptDiagram.pdf}
    \caption{High-Level Concept}
    \label{Fig_ConceptDiagram}
\end{figure*}
 





%=====================================================================
\section{Implementation}

To validate the concept (from Chap. \ref{Sec_ConceptArchitecture}) a simplified version is implemented as prototype to verify that reference independent defect detection based on context data is possible and determine to which extent.

Contextual features essential for the production concept, yet easily abstracted, are omitted to prioritise features with influence-characteristics that are challenging to assess beforehand. For example, if reliable defect classification works on one type of machine, it is probable to perform similarly on another machine when trained on data specific to said machine.
Given the rationale of the example above, features such as 'machine-type' and 'material' are excluded from the prototype's contextual data.
The feature 'stock shape' is believed to influence Eigen-frequencies, particularly on slender parts. To ensure explicit testability, only non-slender geometries are retained, leading to the rationalisation of the 'stock shape' feature.
An example of a feature deemed relevant for the prototype, owing to the difficulty of generalizing it beforehand, is the 'contact-arc'.





To prevent data imbalance, ensure broad coverage of context parameter values \& combinations, and achieve a clean reproducible dataset, a Design of Experiment (DoE) approach is employed. This involves creating a static dataset by defining the span of parameter values and their combinations as sets of Unique (context) Parameter Combinations (UPCs) beforehand.
Based on the UPCs, stock shape, and defect-mode a CNC a tool path is calculated and translated into machine code to run on the CNC-mill. 


In detail this means that synthetic defects are placed at known locations on the prepaired workpiece with an engraving end mill, that are then machined with preconfigured context data (UPCs). 
With this aproach it is easy to test specific context parameter settings and automate datalabeling (defect \& context labels), while ensuring precise defect label placement.


The data generation pipeline developed for the simplified model automates the entire process from generating a DoE matrix \& UPCs, tool path planing, machine code generation, context extraction based on the cutting simulation (digital twin), data collection, and data labeling.

\begin{figure}[t]
    \centering
    \includegraphics[width=0.99\linewidth]{dataset_gen.png}
    \caption{dataset gen}
    \label{dataset_gen}
\end{figure}




The following sections describe the hardware used in the experiments, the experiment setup, the generated dataset and the ML model.

\subsection{Hardware}
\vspace*{-\baselineskip}
The experiments are carried out on a 3-axis 'EMCO CM260' CNC milling machine with a (emulated) Siemens Sinumerik controller. The machining vibrations are measured by an accelerometer mounted on the machine vice close to the workpiece. The accelerometer 'ADXL1002' is a high frequency (21 $kHz$ resonant frequency) MEMS (microelectromechanical systems) sensor with a low noise density (25 $\frac{\mu g}{\sqrt{Hz}}$). The accelerometer is connected via a coaxial cable to a 'Digilent MCC172' a DAQ (data aquisition) unit with a sampling rate of 51.2 $kHz$.
The DAQ unit is connected via the 40-pin GPIO (genral-purpose input/output) header of a 'Raspberry Pi 3' - a SoC (Systems on Chip) Desktop-Computer - that functions as data logger.







\subsection{Experiment setup and dataset}
\vspace*{-\baselineskip}
The procedure that yields the finished dataset is tighlty interlocked with the automated data generation pipeline.
First, selected context features are defined with span and step size. Then a matrix of all parameter combination is created, where each line represents a UPC Unique (context) Parameter Combination. 
Based on the definded stock shape UPCs are grouped together. Each group of UPCs represents a z-layer of the workpiece. For each layer a toolpath is calculated not only consisisting of the UPCs toolpaths but also the toolpath to first clean all relevant workpiece edges \& surfaces and generate the toolpath for defect-manufacturing via an engraving end mill.
The layer specific toolpaths are then appended together for a single clamping operation.
The monolithic toolpath containing several layers is then translated into machine code, which is both executed on the CNC-machine and on the digital twin: the cutting simulation for context (defect-label) generaration. Each layer of vibration measurement and context is saved as a seperate file (see Fig. \ref{dataset_gen}a)).
Layer by layer the raw vibration record and the associated context data is loaded and cut into segments, filtering any cleaning operations and air cuts, leaving single vibration snippets, each with a unique context paramater combination and defect-label mapping based on the associated context data.

The raw vibration snipets are then dissasembled into frequency bands (displayed as spectrograms Fig. \ref{dataset_gen}c)). Based on this time-frequency representation and defect label mapping, defect samples are extracted. The same number of non-defect samples are extracted at random points in time. The samples are a selection of relevant frequency bands which are further down-sampled (Fig. \ref{dataset_gen}d)). Relevance of frequency bands is assesed based on the full context spectrum differentiating defects from non-defects. Each sample is then augmented by 0.03 seconds before and after the designated time.\\

\# dataset\\
The resulting dataset is based on 108 unique context parameter combinations (UPCs). For each UPC three artifical defects are machined and a sample extracted. For each defect sample a non-defect sample is extracted based on random time.
With a forward/backwards augmentation for each sample the resulting dataset consists of 1944 entries (108 UPCs x 3 defects x2 for each non-defect x 3 for augmentation).
Each of this 1944 entries consists of 3 types of data:
\begin{enumerate}
	\item vibration data in the shape of time-frequency matrix with 32 frequency band channels on the y-axis and 128 time channels on the x-axis which can be rendered as spectrogram
	\item context data consisting of: $a_e, v_c, f_z, a_{p\%}, d, f_z,$ direction, contact arc, arc direction
	\item defect label: marking the entry as defect or non-defect
\end{enumerate}



\subsection{ML model}
\vspace*{-\baselineskip}
The 



\begin{figure}[t]
    \centering
    \includegraphics[width=0.99\linewidth]{ML_architecture.png}
    \caption{ML architecture}
    \label{ML_architecture}
\end{figure}



 
%=====================================================================
\section{Validation}
\begin{note}
	...and evaluation
	
	Dashboard streamlit -> context influence, full data reperesentation -nope!!

\end{note}


Accuracy: 0.988013698630137\\
Precision: 0.9929078014184397\\
Recall: 0.9824561403508771\\
F1-score: 0.9876543209876543\\
Confusion Matrix:\\
297   2\\
  5 280\\
 
 
 
%=====================================================================
\section{Conclusion and outlook}
\begin{note}
	and future recommendation
	
\end{note}





%=====================================================================
%=====================================================================
%% For references without a BibTeX database:
% JO bibliography
%\printbibliography               %biblatex -nope!
\bibliographystyle{elsarticle-num} %elsevierspecific -yep!
\bibliography{Bibliography.bib} %natbib %elsevier is based on natbib -so yep!

\end{document}
